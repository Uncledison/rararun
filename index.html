<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rararun Final Debug</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.js"></script>
    <style>
        /* 모바일 전체 화면을 위해 기본 여백 제거 */
        body { margin: 0; padding: 0; background-color: #000; }
    </style>
</head>
<body>
    <script>
        
        class GameScene extends Phaser.Scene {
            constructor() {
                super({ key: 'GameScene' });
                this.lanePositions = [ 0, 240, 360, 480 ];
                this.currentLane = 2; // 중앙 레인(2번)에서 시작
                this.player = null; 
                this.statusText = null;     
            }
            
            // 1. 에셋 로드: dot.png 로 변경
            preload() {
                this.load.image('dot', 'assets/dot.png');
            }

            create() {
                this.cameras.main.setBackgroundColor('#000000');
                
                // 디버깅 텍스트 생성
                this.statusText = this.add.text(10, 10, 'Initializing...', { 
                    fontSize: '24px', 
                    fill: '#00ff00' 
                });
                
                // *******************************************************
                // * 핵심: 물리 엔진 Sprite 생성 (키를 'dot'로 변경)
                // *******************************************************
                const playerX = this.lanePositions[this.currentLane];
                const playerY = 1000; 

                this.player = this.physics.add.sprite(
                    playerX, 
                    playerY, 
                    'dot' // 로드한 'dot' 이미지를 사용
                );
                this.player.setScale(2.0); // 이미지를 두 배로 확대
                this.player.setImmovable(true); 

                // 캔버스 터치 이벤트를 등록합니다.
                this.input.on('pointerdown', this.handleInput, this);
            }
            
            update(time, delta) {
                this.statusText.setText(`Lane: ${this.currentLane} / X: ${this.player.x}`);
            }

            // *******************************************************
            // * 핵심: 좌우 터치 로직 안정화 (현재 레인 위치 기반)
            // *******************************************************
            handleInput(pointer) {
                let newLane = this.currentLane;

                // 터치 위치가 현재 플레이어 X좌표보다 작은지 판단
                const isLeftTouch = pointer.x < this.player.x;

                if (isLeftTouch) {
                    // 왼쪽 터치: 왼쪽으로 이동 시도
                    newLane = Math.max(1, this.currentLane - 1);
                } else {
                    // 오른쪽 터치: 오른쪽으로 이동 시도
                    newLane = Math.min(3, this.currentLane + 1);
                }
                
                if (newLane !== this.currentLane) {
                    this.currentLane = newLane;
                    this.tweens.add({
                        targets: this.player,
                        x: this.lanePositions[this.currentLane],
                        duration: 150,
                        ease: 'Power1'
                    });
                }
            }
        }

        // 게임 환경 설정 (config)
        const config = {
            type: Phaser.AUTO,
            width: 720,  
            height: 1280, 
            physics: {
                default: 'arcade', 
                arcade: {}
            },
            scene: [GameScene]
        };

        // 게임 시작
        const game = new Phaser.Game(config);

    </script>
</body>
</html>
